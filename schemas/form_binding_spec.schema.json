{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://lifeos.com/schemas/form_binding_spec/1-0-0.json",
  "title": "Form Binding Spec",
  "description": "Schema for form-to-measure binding specifications",
  "type": "object",
  "required": ["type", "form_id", "binding_id", "version", "sections"],
  "properties": {
    "type": {
      "type": "string",
      "const": "form_binding_spec"
    },
    "form_id": {
      "type": "string",
      "description": "Platform-specific form identifier (e.g., googleforms::abc123)"
    },
    "binding_id": {
      "type": "string",
      "pattern": "^[a-z][a-z0-9_]*$",
      "description": "Unique identifier for this binding spec"
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "SemVer version string"
    },
    "description": {
      "type": "string",
      "description": "Human-readable description of this binding"
    },
    "sections": {
      "type": "array",
      "minItems": 1,
      "description": "Sections mapping form fields to measure items",
      "items": {
        "type": "object",
        "required": ["measure_id", "measure_version", "bindings"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Human-readable section name"
          },
          "measure_id": {
            "type": "string",
            "description": "Target measure identifier"
          },
          "measure_version": {
            "type": "string",
            "pattern": "^\\d+\\.\\d+\\.\\d+$",
            "description": "Target measure version"
          },
          "bindings": {
            "type": "array",
            "minItems": 1,
            "description": "Item-level bindings",
            "items": {
              "type": "object",
              "required": ["item_id", "by", "value"],
              "properties": {
                "item_id": {
                  "type": "string",
                  "description": "Target measure item_id"
                },
                "by": {
                  "type": "string",
                  "enum": ["field_key", "position"],
                  "description": "How to match the form item"
                },
                "value": {
                  "oneOf": [
                    { "type": "string" },
                    { "type": "integer" }
                  ],
                  "description": "The field_key string or position number to match"
                }
              }
            }
          }
        }
      }
    }
  }
}
